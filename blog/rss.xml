<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>AuthCrunch aka Caddy Security Documentation Blog</title>
        <link>https://docs.authcrunch.com/blog</link>
        <description>AuthCrunch aka Caddy Security Documentation Blog</description>
        <lastBuildDate>Sun, 25 Feb 2024 00:00:00 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[Secure Deployment of Application with Azure Container Instances and Caddy]]></title>
            <link>https://docs.authcrunch.com/blog/azure-container-instances-caddy-security</link>
            <guid>https://docs.authcrunch.com/blog/azure-container-instances-caddy-security</guid>
            <pubDate>Sun, 25 Feb 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[This tutorial walks you through deploying applications protected by caddy security app,]]></description>
            <content:encoded><![CDATA[<p>This tutorial walks you through deploying applications protected by caddy security app,
hosted by Caddy web server via Azure Container Instances (ACI) service.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="table-of-contents">Table of Contents<a href="https://docs.authcrunch.com/blog/azure-container-instances-caddy-security#table-of-contents" class="hash-link" aria-label="Direct link to Table of Contents" title="Direct link to Table of Contents">​</a></h2>
<ul>
<li><a href="https://docs.authcrunch.com/blog/azure-container-instances-caddy-security#azure-configuration">Azure Configuration</a>
<ul>
<li><a href="https://docs.authcrunch.com/blog/azure-container-instances-caddy-security#add-azure-file-share">Add Azure File Share</a></li>
<li><a href="https://docs.authcrunch.com/blog/azure-container-instances-caddy-security#copy-files-to-azure-file-share">Copy Files to Azure File Share</a></li>
<li><a href="https://docs.authcrunch.com/blog/azure-container-instances-caddy-security#container-deployment">Container Deployment</a></li>
</ul>
</li>
<li><a href="https://docs.authcrunch.com/blog/azure-container-instances-caddy-security#accessing-container">Accessing Container</a></li>
<li><a href="https://docs.authcrunch.com/blog/azure-container-instances-caddy-security#troubleshooting">Troubleshooting</a></li>
<li><a href="https://docs.authcrunch.com/blog/azure-container-instances-caddy-security#conclusion">Conclusion</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="azure-configuration">Azure Configuration<a href="https://docs.authcrunch.com/blog/azure-container-instances-caddy-security#azure-configuration" class="hash-link" aria-label="Direct link to Azure Configuration" title="Direct link to Azure Configuration">​</a></h2>
<p>Define environment variables. Change <code>app</code> to something else, e.g. <code>xyz</code>.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export ACI_RG_NAME=app-auth-rg-001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export ACI_ST_ACCOUNT_NAME=appauthst001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export ACI_LOCATION=eastus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export ACI_ST_SHARE_NAME=appauthstsh001</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Next, create resource group:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">az group create --name "${ACI_RG_NAME}" --location eastus</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-azure-file-share">Add Azure File Share<a href="https://docs.authcrunch.com/blog/azure-container-instances-caddy-security#add-azure-file-share" class="hash-link" aria-label="Direct link to Add Azure File Share" title="Direct link to Add Azure File Share">​</a></h3>
<p>References:</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/container-instances/container-instances-volume-azure-files" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/en-us/azure/container-instances/container-instances-volume-azure-files</a></li>
<li>Reference: <a href="https://learn.microsoft.com/en-us/cli/azure/provider?view=azure-cli-latest#az-provider-register" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/en-us/cli/azure/provider?view=azure-cli-latest#az-provider-register</a></li>
</ul>
<p>Register a provider using your subscription ID:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">az provider register -n Microsoft.Storage --subscription 91cd6b60-64b7-46e2-bffb-952352196549</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Create a storage account:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">az storage account create --resource-group "${ACI_RG_NAME}" --name "${ACI_ST_ACCOUNT_NAME}" --location "${ACI_LOCATION}" --sku Standard_LRS</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Review the newly created account:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">az storage account list | jq -r '.[]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Create a file share:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">az storage share create --name "${ACI_ST_SHARE_NAME}" --account-name "${ACI_ST_ACCOUNT_NAME}"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="copy-files-to-azure-file-share">Copy Files to Azure File Share<a href="https://docs.authcrunch.com/blog/azure-container-instances-caddy-security#copy-files-to-azure-file-share" class="hash-link" aria-label="Direct link to Copy Files to Azure File Share" title="Direct link to Copy Files to Azure File Share">​</a></h3>
<p>Navigate to Resource Group, then browse to Storage Share associated with it.</p>
<p><img decoding="async" loading="lazy" src="https://github.com/authcrunch/authcrunch.github.io/assets/3826416/447d6cef-d50e-4c2b-85be-676970a2712a" alt="image" class="img_ev3q"></p>
<p>Next, open the share, click "Browse" and add the following nested directories. The <code>app-auth-ci-001</code> is the name of the Caddy instance (ACI container).</p>
<ul>
<li><code>caddy</code>,<!-- -->
<ul>
<li><code>app-auth-ci-001</code>
<ul>
<li><code>config</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img decoding="async" loading="lazy" src="https://github.com/authcrunch/authcrunch.github.io/assets/3826416/ee9c2d02-e9a7-4790-a34b-7c959b5c1d8e" alt="image" class="img_ev3q"></p>
<p>Next, browse to <code>caddy/app-auth-ci-001/config</code> and upload <code>Caddyfile</code> with the following content.</p>
<p><img decoding="async" loading="lazy" src="https://github.com/authcrunch/authcrunch.github.io/assets/3826416/a58883fc-3d13-40e9-aae0-1ed037f6cd0a" alt="image" class="img_ev3q"></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	http_port 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	https_port 443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	admin off</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	debug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	order authenticate before respond</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	order authorize before basicauth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	security {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		local identity store localdb {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			realm local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			path {env.LOCAL_DATA_PATH}caddy/app-auth-ci-001/userdb/users.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			user webadmin {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				name Webmaster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				email webadmin@localhost.localdomain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				# echo -n "App@2f4cb79053be" | bcrypt-cli -c 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				password "$2a$10$JqJEf2pra4hIkw4CSDePoOfIoXVUFwSn6pJie6m02MUP7YGQVPQAi" overwrite</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				roles "authp/admin" "authp/user"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			user jsmith {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				name John Smith</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				email jsmith@localhost.localdomain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				# password {env.USER_JSMITH_SECRET}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				password "App@2f4cb79053be"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				roles "authp/admin" "authp/user"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		authentication portal myportal {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			crypto default token lifetime 7200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			crypto key sign-verify {env.JWT_SHARED_KEY}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			cookie domain app-auth-ci-001.eastus.azurecontainer.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			ui {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				links {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">					"My Identity" "/auth/whoami" icon "las la-user"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">					"File Server" "/" icon "las la-cloud"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			transform user {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				match origin local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				action add role authp/user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			enable identity store localdb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		authorization policy file_server_policy {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			crypto key sign-verify {env.JWT_SHARED_KEY}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			set auth url /auth/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			allow roles "authp/admin" "authp/user"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">:80 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	redir https://{host}{uri} 302</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">:443 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	tls internal {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		on_demand</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	route /version* {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		respond "app 1.0"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	route /debug* {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		authorize with file_server_policy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		header Content-Type text/html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		respond &lt;&lt;EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		&lt;html&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		&lt;body&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		&lt;p&gt;Host: &lt;code&gt;{http.request.host}&lt;/code&gt;&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		&lt;p&gt;Time: &lt;code&gt;{time.now.common_log}&lt;/code&gt;&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		&lt;p&gt;ID: &lt;code&gt;{http.auth.user.id}&lt;/code&gt;&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		&lt;/body&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		&lt;/html&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		EOF 200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	route /auth* {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		authenticate with myportal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	route /* {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		authorize with file_server_policy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		file_server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			root {env.LOCAL_DATA_PATH}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			browse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="container-deployment">Container Deployment<a href="https://docs.authcrunch.com/blog/azure-container-instances-caddy-security#container-deployment" class="hash-link" aria-label="Direct link to Container Deployment" title="Direct link to Container Deployment">​</a></h3>
<p>Get Storage Account Key:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ACI_ST_ACCOUNT_KEY=$(az storage account keys list --resource-group "${ACI_RG_NAME}" --account-name "${ACI_ST_ACCOUNT_NAME}" --query "[0].value" --output tsv)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo $ACI_ST_ACCOUNT_KEY</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Next, deploy the container:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">az container create --resource-group "${ACI_RG_NAME}" \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --name "app-auth-ci-001" \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --image "ghcr.io/authcrunch/authcrunch:latest" \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --dns-name-label "app-auth-ci-001" \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --ports 80 443 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --azure-file-volume-account-name "${ACI_ST_ACCOUNT_NAME}" \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --azure-file-volume-account-key "${ACI_ST_ACCOUNT_KEY}" \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --azure-file-volume-share-name "${ACI_ST_SHARE_NAME}" \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --environment-variables LOCAL_DATA_PATH="/app/data/" JWT_SHARED_KEY="d24ae7de-ca54-4334-94ba-301fc414d5de" XDG_DATA_HOME="/app/data/caddy/app-auth-ci-001/data" XDG_CONFIG_HOME="/app/data/caddy/app-auth-ci-001/config" \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --azure-file-volume-mount-path /app/data/ \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --command-line "caddy run --config /app/data/caddy/app-auth-ci-001/config/Caddyfile"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="accessing-container">Accessing Container<a href="https://docs.authcrunch.com/blog/azure-container-instances-caddy-security#accessing-container" class="hash-link" aria-label="Direct link to Accessing Container" title="Direct link to Accessing Container">​</a></h2>
<p>Browse to container URL: <code>https://app-auth-ci-001.eastus.azurecontainer.io/</code></p>
<p>The first time your access your container, you get that the site is unreachable.</p>
<p><img decoding="async" loading="lazy" src="https://github.com/authcrunch/authcrunch.github.io/assets/3826416/b243c468-9399-4676-a848-be961c6e5d2f" alt="image" class="img_ev3q"></p>
<p>If you refresh after 10-15 seconds, you will get the connection is not private. It is expected. Trust the cert and proceed</p>
<p><img decoding="async" loading="lazy" src="https://github.com/authcrunch/authcrunch.github.io/assets/3826416/2a0337f9-8090-4712-a6f0-dd8b7b920888" alt="image" class="img_ev3q"></p>
<p>After that, log in with username <code>jsmith</code> and password <code>App@2f4cb79053be</code>.</p>
<p><img decoding="async" loading="lazy" src="https://github.com/authcrunch/authcrunch.github.io/assets/3826416/a7b70a8b-fc4c-4c90-90c3-0bccd751c0e1" alt="image" class="img_ev3q"></p>
<p>Click "File Server" to get redirected to Caddy file server browser:</p>
<p><img decoding="async" loading="lazy" src="https://github.com/authcrunch/authcrunch.github.io/assets/3826416/c525674d-c54d-457f-a5d6-bef5c96f9d99" alt="image" class="img_ev3q"></p>
<p>You should be able to browse the contents of <code>/app/data</code> directory.</p>
<p><img decoding="async" loading="lazy" src="https://github.com/authcrunch/authcrunch.github.io/assets/3826416/b9cf61c7-ca34-419e-a058-0c619339b9aa" alt="image" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="troubleshooting">Troubleshooting<a href="https://docs.authcrunch.com/blog/azure-container-instances-caddy-security#troubleshooting" class="hash-link" aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting">​</a></h2>
<p>List containers:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">az container list --resource-group "${ACI_RG_NAME}"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Check logs:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">az container logs --resource-group "${ACI_RG_NAME}" --name "app-auth-ci-001"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">az container show --resource-group "${ACI_RG_NAME}" --name "app-auth-ci-001"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="https://docs.authcrunch.com/blog/azure-container-instances-caddy-security#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>There are some gaps in my explanation. Please engage, ask questions <a href="https://github.com/authcrunch/authcrunch.github.io/issues" target="_blank" rel="noopener noreferrer">here</a>
or submit edits <a href="https://github.com/authcrunch/authcrunch.github.io/edit/main/blog/2024-02-25-azure-container-instances-caddy-security/index.md" target="_blank" rel="noopener noreferrer">here</a>.</p>]]></content:encoded>
            <category>blog</category>
        </item>
        <item>
            <title><![CDATA[Welcome]]></title>
            <link>https://docs.authcrunch.com/blog/welcome</link>
            <guid>https://docs.authcrunch.com/blog/welcome</guid>
            <pubDate>Sun, 31 Oct 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[Please share your stories about Caddy and auth plugins!]]></description>
            <content:encoded><![CDATA[<p>Please share your stories about Caddy and auth plugins!</p>
<p>Simply add Markdown files (or folders) to the
<a href="https://github.com/authcrunch/authcrunch.github.io/new/main/blog/" target="_blank" rel="noopener noreferrer"><code>blog/</code></a>
directory.</p>
<p>Additionally, add yourself to blog authors via
<a href="https://github.com/authcrunch/authcrunch.github.io/edit/main/blog/authors.yml" target="_blank" rel="noopener noreferrer"><code>authors.yml</code></a>.</p>
<p>If your blog post has images, then create a folder for the post
and co-locate images with the post itself.</p>
<ul>
<li><code>2021-10-31-mypost/index.md</code></li>
<li><code>2021-10-31-mypost/image1.jpeg</code></li>
</ul>
<p>Include the image in the <code>.md</code> file with the following snippet:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">![Image for my post](./image1.jpeg)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The blog post date can be extracted from filenames, such as:</p>
<ul>
<li><code>2021-10-31-welcome.md</code></li>
<li><code>2021-10-31-welcome/index.md</code></li>
</ul>]]></content:encoded>
            <category>blog</category>
        </item>
    </channel>
</rss>